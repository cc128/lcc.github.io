(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e544e410"],{"053b":function(e,t,i){var o=i("1e2c"),n=i("d910").f,a=Function.prototype,s=a.toString,r=/^\s*function ([^ (]*)/,c="name";o&&!(c in a)&&n(a,c,{configurable:!0,get:function(){try{return s.call(this).match(r)[1]}catch(e){return""}}})},"2acf":function(e,t,i){"use strict";var o=i("5c6f"),n=i.n(o);n.a},"5c6f":function(e,t,i){},"721a":function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"open-live"},[!1===e.isLive?i("el-button",{staticClass:"btn",attrs:{type:"success"},on:{click:e.startVideo}},[e._v("开始直播")]):i("el-button",{staticClass:"btn",attrs:{type:"danger"},on:{click:e.overLive}},[e._v("结束直播")]),i("video",{directives:[{name:"show",rawName:"v-show",value:e.isLive,expression:"isLive"}],attrs:{id:"anchor-video"}}),i("div",{staticClass:"user-list"},e._l(e.userData,(function(t,o){return i("div",{key:o},[e._v(e._s(t.name))])})),0)],1)},n=[],a=(i("053b"),i("ad54")),s={data:function(){return{anchorVideo:null,isLive:!1,socketId:this.$store.state.socketId,userData:[],webRTC:new a["a"],mYname:sessionStorage.getItem("mYname")||null}},watch:{},created:function(){this.socketId&&this.$socket.emit("userLink",{name:this.mYname,socketId:this.socketId,type:this.$route.name})},mounted:function(){},methods:{startVideo:function(){var e=this;this.webRTC.getCamera("#anchor-video").then((function(t){e.socketId=e.$store.state.socketId,e.$socket.emit("linkLive",{name:e.mYname,socketId:e.socketId,type:e.$route.name}),e.localStream=t.localStream,e.anchorVideo=t.videoBox,e.isLive=!0,e.webRTC.getStream(e.localStream,(function(t){console.log(t),e.$socket.emit("liveVideStream",{socketId:e.socketId,video:t.data,time:e.anchorVideo.currentTime})}),5e3)})).catch((function(e){console.log("无可调用设备",e)}))},overLive:function(){this.webRTC.closeCamera(this.anchorVideo),this.isLive=!1,this.$socket.emit("overLive",{name:this.mYname,socketId:this.socketId,type:this.$route.name})}},beforeDestroy:function(){this.anchorVideo&&this.overLive()}},r=s,c=(i("2acf"),i("9ca4")),d=Object(c["a"])(r,o,n,!1,null,null,null);t["default"]=d.exports},ad54:function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}var s=function(){function e(t,i){o(this,e),this.mediaRecorder=null,this.videoBox=null,this.tracks=null,this.front=!0}return a(e,[{key:"getCamera",value:function(e){var t=this;return this.videoBox=document.querySelector(e),navigator.mediaDevices.getUserMedia({audio:!1,video:{width:this.videoBox.offsetHeight,height:this.videoBox.offsetWidth,facingMode:this.front?"environment":"user"}}).then((function(e){return t.tracks=e.getTracks()[0],t.videoBox.srcObject=e,t.videoBox.onloadedmetadata=function(e){t.videoBox.play()},{videoBox:t.videoBox,localStream:e}}))}},{key:"getStream",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;this.mediaRecorder=new MediaRecorder(e,{mimeType:"video/webm;codecs=vp9"}),this.mediaRecorder.ondataavailable=function(e){t(e)},this.mediaRecorder.start(i)}},{key:"closeCamera",value:function(e){this.tracks&&this.tracks.stop()}},{key:"overVideo",value:function(e){this.mediaRecorder&&this.mediaRecorder.stop()}},{key:"reversal",value:function(){this.front=!this.front}}]),e}();t["a"]=s}}]);