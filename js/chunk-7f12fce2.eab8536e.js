(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7f12fce2"],{"053b":function(e,t,a){var i=a("1e2c"),o=a("d910").f,s=Function.prototype,c=s.toString,n=/^\s*function ([^ (]*)/,l="name";i&&!(l in s)&&o(s,l,{configurable:!0,get:function(){try{return c.call(this).match(n)[1]}catch(e){return""}}})},"2c67":function(e,t,a){},"7fc3":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"video-call"},[e._l(e.userData,(function(t,i){return a("div",{directives:[{name:"show",rawName:"v-show",value:t.socketId!==e.socketId,expression:"item.socketId !== socketId"}],key:i,staticClass:"user-list"},[a("div",[e._v(e._s(t.name))]),a("div",{staticStyle:{flex:"1"}}),a("div",{staticClass:"icon-btn",on:{click:function(a){return e.callF(t)}}},[a("svg",{staticClass:"icon",attrs:{t:"1588602834610",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3774",width:"25",height:"25"}},[a("path",{attrs:{d:"M641.489535 506.850196H361.543284a35.169772 35.169772 0 1 1 0-70.339544h279.946251a35.169772 35.169772 0 0 1 0 70.339544zM641.489535 328.690913H361.543284a35.169772 35.169772 0 1 1 0-70.339544h279.946251a35.169772 35.169772 0 0 1 0 70.339544z",fill:"#FF4B9D","p-id":"3775"}}),a("path",{attrs:{d:"M509.025284 720.692678a203.060508 203.060508 0 0 1-202.803794-202.932152V208.035491a202.932151 202.932151 0 1 1 405.735946 0v309.725035A203.060508 203.060508 0 0 1 509.025284 720.692678z m0-645.249795a132.592607 132.592607 0 0 0-132.46425 132.592608v309.725035a132.592607 132.592607 0 0 0 265.056858 0V208.035491A132.720964 132.720964 0 0 0 509.025284 75.442883zM688.724849 825.303496a35.298129 35.298129 0 0 1-18.483384-65.205271 303.820621 303.820621 0 0 0 145.428291-260.179298v-68.029121a35.169772 35.169772 0 0 1 70.339544 0v68.029121a373.903452 373.903452 0 0 1-178.801067 320.121939 34.913058 34.913058 0 0 1-18.483384 5.26263z",fill:"#0060F7","p-id":"3776"}}),a("path",{attrs:{d:"M510.052139 875.747731A376.342231 376.342231 0 0 1 134.223335 499.918927v-68.029121a35.169772 35.169772 0 0 1 70.339544 0v68.029121a305.874331 305.874331 0 0 0 305.48926 305.48926 35.169772 35.169772 0 1 1 0 70.339544z",fill:"#0060F7","p-id":"3777"}}),a("path",{attrs:{d:"M510.052139 1023.999872a35.169772 35.169772 0 0 1-35.169772-35.169772V840.577959a35.298129 35.298129 0 0 1 70.467901 0v148.252141a35.169772 35.169772 0 0 1-35.298129 35.169772z",fill:"#0060F7","p-id":"3778"}})])]),a("div",{staticClass:"icon-btn",on:{click:function(a){return e.callF(t)}}},[a("svg",{staticClass:"icon",attrs:{t:"1588602941840",viewBox:"0 0 1521 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"6769",width:"30",height:"30"}},[a("path",{attrs:{d:"M791.426681 1024H200.773245A201.149577 201.149577 0 0 1 0 823.226755V200.773245A201.149577 201.149577 0 0 1 200.773245 0h696.214627a201.149577 201.149577 0 0 1 200.961411 200.773245v768.470415a51.557516 51.557516 0 0 1-103.115031 0V200.773245a97.84638 97.84638 0 0 0-97.658214-97.658214h-696.214627a97.84638 97.84638 0 0 0-97.658214 97.658214v622.45351a97.84638 97.84638 0 0 0 97.658214 97.658214h590.46527a51.557516 51.557516 0 0 1 0 103.115031z",fill:"#0060F7","p-id":"6770"}}),a("path",{attrs:{d:"M1425.922822 826.049247a96.341051 96.341051 0 0 1-56.449834-18.816612L1026.44616 553.396545a51.557516 51.557516 0 0 1 0-82.79309l342.46233-253.647924a95.776553 95.776553 0 0 1 152.790885 76.959941v436.357222a96.152885 96.152885 0 0 1-95.776553 95.776553z m-282.249173-314.049247L1418.584344 715.031239V308.404263z",fill:"#0060F7","p-id":"6771"}}),a("path",{attrs:{d:"M793.308343 795.37817H282.249173a51.557516 51.557516 0 1 1 0-103.115031h511.05917a51.557516 51.557516 0 0 1 0 103.115031zM776.185226 355.257626H639.764792a51.745682 51.745682 0 0 1 0-103.303197h136.796766a51.745682 51.745682 0 0 1 0 103.303197z",fill:"#FF4B9D","p-id":"6772"}})])])])})),a("div",{directives:[{name:"show",rawName:"v-show",value:e.userData.length<=1,expression:"userData.length <= 1"}],staticStyle:{"text-align":"center"}},[a("br"),a("br"),a("span",[e._v("暂无连接用户")])]),a("div",{directives:[{name:"show",rawName:"v-show",value:2===e.who,expression:"who === 2"}],staticClass:"call-box"},[a("div",[e._v(e._s(e.stateText))]),a("div",{staticClass:"btn-box"},[a("el-button",{attrs:{type:"danger"},on:{click:e.overCallF}},[e._v("挂断")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isReception,expression:"isReception"}],attrs:{type:"success"},on:{click:e.takeInF}},[e._v("接听")])],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:1===e.who,expression:"who === 1"}],staticClass:"call-box"},[a("div",[e._v(e._s(e.stateText))]),a("div",{staticClass:"btn-box"},[a("el-button",{attrs:{type:"danger"},on:{click:e.overCallF}},[e._v("挂断")])],1)]),a("video",{directives:[{name:"show",rawName:"v-show",value:this.callVideo,expression:"this.callVideo"}],attrs:{id:"callVideo",autoplay:""}}),a("video",{directives:[{name:"show",rawName:"v-show",value:this.calledVideo,expression:"this.calledVideo"}],attrs:{id:"calledVideo",autoplay:"autoplay",muted:"muted"},domProps:{muted:!0}})],2)},o=[],s=(a("053b"),a("e18c"),a("96db"),a("8256"),a("ab6e"),a("927c"),a("3c51"),a("db0a"),a("1cc1"),a("ab0f"),a("fc6e"),a("f30b"),a("cfd1"),a("d104"),a("f74a"),a("3598"),a("b497"),a("2909"),a("a7ef"),a("b523"),a("e671"),a("4140"),a("83db"),a("829d"),a("939f"),a("1bb1"),a("c3ba"),a("af86"),a("f1a9"),a("ad54")),c={data:function(){return{track:null,mYname:sessionStorage.getItem("mYname")||"用户",webRTC:new s["a"],localStream:null,callVideo:null,calledVideo:null,isReception:!1,who:0,stateText:"",callId:"",calledId:"",socketId:this.$store.state.socketId,userData:this.$store.state.videoCallUserList,mediaRecorder:null,mediaSource:null,sourceBuffer:null}},watch:{"$store.state.socketId":function(e,t){e&&(this.socketId=this.$store.state.socketId,this.$socket.emit("userLink",{name:this.mYname,socketId:this.socketId,type:this.$route.name}))},"$store.state.videoCallUserList":function(e,t){e&&(this.userData=this.$store.state.videoCallUserList)}},created:function(){this.socketId&&this.$socket.emit("userLink",{name:this.mYname,socketId:this.socketId,type:this.$route.name})},mounted:function(){var e=this;this.$socket.on("showCall",(function(t){e.isReception=!0,e.stateText="呼叫人：".concat(t.name),e.who=2,e.callId=t.callId,e.calledId=t.calledId})),this.$socket.on("secretMsg",(function(t){!0===t.isConsent?(e.isReception=!1,e.stateText="视频已链接",e.$nextTick((function(){e.calledVideo=document.querySelector("#calledVideo"),e.mediaSource=new MediaSource,e.calledVideo.src=window.URL.createObjectURL(e.mediaSource),e.mediaSource.addEventListener("sourceopen",e.sourceOpen),e.webRTC.getCamera("#callVideo").then((function(a){e.localStream=a.localStream,e.callVideo=a.videoBox,e.sendVideo(t.sendVideoId)})).catch((function(e){console.log("无可调用设备",e)}))}))):!1===t.isConsent&&(e.webRTC.closeCamera(e.callVideo),e.who=0,e.stateText="",e.calledVideo&&(window.URL.revokeObjectURL(e.calledVideo.src),e.calledVideo.src="",e.calledVideo.removeAttribute("src"),e.calledVideo.load(),console.log("挂断")),e.mediaRecorder&&e.mediaRecorder.stop(),e.mediaSource&&e.mediaSource.removeEventListener("sourceopen",e.sourceOpen),e.callVideo=null,e.calledVideo=null,e.mediaRecorder=null,e.mediaSource=null,e.sourceBuffer=null)})),this.$socket.on("videoMsg",(function(t){console.log("接收视频流"),e.who&&e.sourceBuffer.appendBuffer(new Uint8Array(t.video))}))},methods:{callF:function(e){this.who=1,this.stateText="呼叫：".concat(e.name,"中..."),this.calledId=e.socketId,this.$socket.emit("sendCall",{callId:this.socketId,calledId:this.calledId,name:this.$store.state.mYname})},overCallF:function(){this.$socket.emit("overCall",{callId:this.callId,calledId:this.calledId,who:this.who})},takeInF:function(){this.$socket.emit("tokeCall",{callId:this.callId,calledId:this.calledId})},sendVideo:function(e){var t=this;this.mediaRecorder=new MediaRecorder(this.localStream,{mimeType:"video/webm;codecs=vp9"}),this.mediaRecorder.ondataavailable=function(a){t.who&&t.$socket.emit("videoStreaming",{video:a.data,receiveUserId:e})},this.mediaRecorder.start(300)},sourceOpen:function(e){console.log("111111111111"),this.sourceBuffer=this.mediaSource.addSourceBuffer("video/webm;codecs=vp9")}}},n=c,l=(a("fbd0"),a("9ca4")),d=Object(l["a"])(n,i,o,!1,null,null,null);t["default"]=d.exports},ad54:function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}var c=function(){function e(t,a){i(this,e),this.mediaRecorder=null,this.videoBox=null,this.tracks=null,this.front=!0}return s(e,[{key:"getCamera",value:function(e){var t=this;return this.videoBox=document.querySelector(e),navigator.mediaDevices.getUserMedia({audio:!1,video:{width:this.videoBox.offsetHeight,height:this.videoBox.offsetWidth,facingMode:this.front?"environment":"user"}}).then((function(e){return t.tracks=e.getTracks()[0],t.videoBox.srcObject=e,t.videoBox.onloadedmetadata=function(e){t.videoBox.play()},{videoBox:t.videoBox,localStream:e}}))}},{key:"getStream",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;this.mediaRecorder=new MediaRecorder(e,{mimeType:"video/webm;codecs=vp9"}),this.mediaRecorder.ondataavailable=function(e){t(e)},this.mediaRecorder.start(a)}},{key:"closeCamera",value:function(e){this.tracks&&this.tracks.stop()}},{key:"overVideo",value:function(e){this.mediaRecorder&&this.mediaRecorder.stop()}},{key:"reversal",value:function(){this.front=!this.front}}]),e}();t["a"]=c},fbd0:function(e,t,a){"use strict";var i=a("2c67"),o=a.n(i);o.a}}]);